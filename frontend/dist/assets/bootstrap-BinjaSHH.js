function k(e){const{log:s}=e;s.info("Registering global error handlers (1. handle window.onerror(), 2. handle unhandled promise rejections...)"),window.onerror=function(i,t,r,c,n){return console.log(`Unhandled error: ${i} at ${t}:${r}:${c}`),n&&n.stack&&console.log(`Stack trace:
${n.stack}`),!1},window.addEventListener("unhandledrejection",i=>{console.log(`Unhandled promise rejection: ${i.reason}`)})}function D(e,s,i,t,r,c){const n=e.web.canvas,y=e.web.form,m=e.web.input,$=e.app.refreshInterval,a=s.elements.createOrUpdateGraveTooltip(null,n),E=s.canvas.reRenderMemoriesAndOverlays(e,i,t,r,c);n&&a&&(n.addEventListener("mousemove",g=>{const l=n.getBoundingClientRect(),d=n.width/l.width,p=n.height/l.height,h=(g.clientX-l.left)*d,w=(g.clientY-l.top)*p,f=E.find(o=>h>=o.x&&h<=o.x+o.width&&w>=o.y&&w<=o.y+o.height);f?(a.textContent=f.memory.text,a.style.display="block",a.style.left=`${g.clientX+16}px`,a.style.top=`${g.clientY+16}px`):a.style.display="none"}),n.addEventListener("mouseleave",()=>{a.style.display="none"})),y&&m&&y.addEventListener("submit",g=>{g.preventDefault();const l=m.value.trim();if(!l)return;const d=r.load(e),p=d.map(v=>({x:v.x??0,y:v.y??0,width:t.math.weightedRandom(e.graves.minSize,e.graves.maxSize,e.graves.weight.large),height:t.math.weightedRandom(e.graves.minSize,e.graves.maxSize,e.graves.weight.large)})),h=e.web.canvas,w=t.math.weightedRandom(e.graves.minSize,e.graves.maxSize,e.graves.weight.large),f=t.math.weightedRandom(e.graves.minSize,e.graves.maxSize,e.graves.weight.large);let o=0,x=0,b=0,u=!1;for(;b<e.graves.maxAttempts&&!u;){o=Math.random()*(h.width-w-e.graves.padding*2)+e.graves.padding,x=Math.random()*(h.height-f-e.graves.padding*2)+e.graves.padding,u=!0;for(const v of p){const S=v.x-o,z=v.y-x,R=(v.width+w)/2+e.graves.padding;if(Math.sqrt(S*S+z*z)<R){u=!1;break}}b++}const L={id:crypto.randomUUID(),text:l,createdAt:Date.now(),x:o,y:x};d.unshift(L),r.save(d,e),m.value="",r.render(e,s.canvas,i,t,c)}),window.addEventListener("DOMContentLoaded",()=>r.render(e,s.canvas,i,t,c)),setInterval(()=>r.render(e,s.canvas,i,t,c),$??2e3)}function I(e,s,i,t,r,c,n){k(c),D(e,s,i,t,r,n)}export{I as bootstrap};
